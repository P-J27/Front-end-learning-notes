面试官：说说 json和jsonp的区别

公司：腾讯

-----------

##### 什么是JSON

　　前面简单说了一下，JSON是一种基于文本的数据交换方式，或者叫做数据描述格式，你是否该选用他首先肯定要关注它所拥有的优点。
　　

##### JSON的优点：

　　1、基于纯文本，跨平台传递极其简单；
　　2、Javascript原生支持，后台语言几乎全部支持；
　　3、轻量级数据格式，占用字符数量极少，特别适合互联网传递；
　　4、可读性较强，虽然比不上XML那么一目了然，但在合理的依次缩进之后还是很容易识别的；
　　5、容易编写和解析，当然前提是你要知道数据结构；

##### 什么是JSONP

> 　JSONP（JSON with Padding）是一个非官方的协议，它允许在服务器端集成 Script tags 返回至客户端，通过 JavaScript Callback的形式`实现跨域访问`。由于 JSON 只是一种含有简单括号结构的纯文本，因此许多通道都可以交换 JSON 消息。而由于同源策略的限制，开发人员不能在外部服务器进行通信的时候使用 XMLHttpRequest。而 JSONP 是一种可以绕过同源策略的方法，即通过使用 JSON 与 `<script> `标记相结合的方法，`从服务器端直接返回可执行的 JavaScript 函数调用或者 JavaScript 对象`，目前 JSONP 已经成为各大公司的 Web 应用程序跨域首选，例如 Youtube GData、Google Social Graph、Digg、知乎、Del.icio.us等。

##### 先说说JSONP是怎么产生的

其实网上关于JSONP的讲解有很多，但却千篇一律，而且云里雾里，对于很多刚接触的人来讲理解起来有些困难，小可不才，试着用自己的方式来阐释一下这个问题，看看是否有帮助。
　　1、一个众所周知的问题，Ajax直接请求普通文件存在跨域无权限访问的问题，甭管你是静态页面、动态网页、web服务、WCF，只要是跨域请求，一律不准；
　　2、不过我们又发现，Web页面上调用js文件时则不受是否跨域的影响（不仅如此，我们还发现凡是拥有”src”这个属性的标签都拥有跨域的能力，比如`<script>、<img>、<iframe>`）；
　　3、于是可以判断，当前阶段如果想通过纯web端（ActiveX控件、服务端代理、属于未来的HTML5之Websocket等方式不算）跨域访问数据就只有一种可能，那就是在远程服务器上设法`把数据装进js格式的文件里，供客户端调用和进一步处理`；
　　4、恰巧我们已经知道有一种叫做JSON的纯字符数据格式可以简洁的描述复杂数据，更妙的是JSON还被js原生支持，所以在客户端几乎可以随心所欲的处理这种格式的数据；
　　5、这样子解决方案就呼之欲出了，web客户端通过与调用脚本一模一样的方式，来调用跨域服务器上动态生成的js格式文件（一般以JSON为后缀），显而易见，服务器之所以要动态生成JSON文件，目的就在于把客户端需要的数据装入进去。
　　6、客户端在对JSON文件调用成功之后，也就获得了自己所需的数据，剩下的就是按照自己需求进行处理和展现了，这种获取远程数据的方式看起来非常像AJAX，但其实并不一样。
　　7、为了便于客户端使用数据，逐渐形成了一种非正式传输协议，人们把它称作JSONP，该协议的一个要点就是允许用户传递一个callback参数给服务端，然后服务端返回数据时会将这个callback参数作为函数名来包裹住JSON数据，这样客户端就可以随意定制自己的函数来自动处理返回数据了。



**我们都知道jsonp是用来解决跨域的，那么是怎么解决的呢？**

> 同源（不懂同源策略的童鞋请自行百度）下的前后端数据交换格式确定使用json了。
>
> 那么问题来了，如果我想获取别人网站上提供的数据肿么做到呢？也就是跨域读取数据问题（不要钻牛角说你不需要读取其他网站的数据，相信我，你早晚得需要）
>
> json行不行呢？答案是No Way
>
> 为什么呢，因为json只是普通的文本格式，能让你这样就轻松拿到那服务端就没有任何安全和保密性可言了，这样的话互联网世界非乱套不可，这个问题那些牛X的规范制定者早就想到了，所以使用了同源策略来限制文件获取。
>
> 最后的结果就是只有像img、script、iframe这类可以指定src属性的标签有跨域获取别人网站上数据（图片，脚本，源文件其实都是数据）的能力。

```html
<!--京东商品图片-->
<img src="http://img30.360buyimg.com/jgsq-productsoa/jfs/t2407/323/1635505465/47386/f2d89d88/56615e00N7a475ee6.jpg" />
<!--百度CDN-->
<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

```

看来直接获取json是行不通了，那有没有其他方法能拿到数据呢？于是乎jsonp就这样被聪明的开发者给发现了，为什么说是发现而不是发明呢，因为并没有涉及到任何新技术，就像发现ajax一样。

##### jsonp**原理**

jsonp原理是这样的，网站A需要获取网站B的数据，网站B说我给你们一个方法，

1. 你们使用`<script src="http://www.B.com/open.js"></script>`标签先获取到open.js文件（网站B的责任），这里边有你们需要的数据。
2. 你们获取数据后处理数据（总得处理数据吧）的方法名必须命名为foo（数据请求者的责任和义务）】，这里相当于B网站和请求获取数据者之间建立了一个协议，要求请求者务必按照规则办事，如果请求者不能同时遵守上面两条就不能按预期获取数据。额…，这也算相当于建立了一个潜规则吧

jsonp全名叫做json with padding.很形象，就是把json对象用符合js语法的形式包裹起来以使其它网站可以请求得到，也就是将json数据封装成js文件；
json是理想的数据交换格式，但没办法跨域直接获取，于是就将json包裹(padding)在一个合法的js语句中作为js文件传过去。这就是json和jsonp的区别，json是想要的东西，jsonp是达到这个目的而普遍采用的一种方法，当然最终获得和处理的还是json。所以说json是目的，jsonp只是手段。json总会用到，而jsonp只有在跨域获取数据才会用到。

##### 两者区别

- json返回的是一串数据；而jsonp返回的是脚本代码（包含一个函数调用）；
- json是一种轻量级的数据交换格式。jsonp是一种跨域数据交互协议。